" ln -s /app/script/conf/vimrc /home/centos/.vimrc
" ln -s /root/code/git/build_dev_env/vim/vimrc /root/.vimrc
" ln -s /Users/mk/code/git/build_dev_env/vim/vimrc /Users/mk/.vimrc
" mkdir ~/.vim/swap/

set fencs=utf-8,gbk,utf-16,utf-32,ucs-bom
set nu
" windows clipboard sperate
set clipboard=unnamed

set colorcolumn=120 " limited to 120 characters per line
highlight ColorColumn ctermbg=Red ctermfg=white
highlight VertSplit ctermbg=gray ctermfg=gray

" Set indent
set smartindent
set tabstop=2 softtabstop=2 shiftwidth=2 expandtab

" Set Search
set hlsearch
set incsearch " Real-Time Search Highlighting
highlight search ctermfg=black ctermbg=yellow
highlight incsearch ctermfg=white ctermbg=darkred

" Set completeopt
"set dictionary+=~/code/git/build_dev_env/vim/vimword,~/code/git/build_dev_env/vim/vimwordphp
set complete+=k

" Specify the list of storage paths for Vim to generate swap files; if .swp has a name conflict, it becomes .swo, then .swn, then .swm, and then .swl
set directory=~/.vim/swap/

" Set statusline
set laststatus=2
hi User1 ctermfg=white ctermbg=darkred cterm=bold
hi User2 ctermfg=white ctermbg=darkblue
hi User3 ctermfg=blue ctermbg=white

set statusline=
set statusline+=%1*  "switch to User1 highlight
set statusline+=\ %m%r\    "Modified? Readonly?
set statusline+=%2*  "switch to User2 highlight
set statusline+=\ %{strlen(&fenc)?&fenc:&enc}\ "encoding
set statusline+=%3*  "switch to User3 highlight
set statusline+=\ Buff:[%n]\  "buffer number
set statusline+=%2*  "switch to User2 highlight
set statusline+=\ Col:\ %c\            " Column
set statusline+=\ Row:\ %l/%L\        " Rownumber/total
set statusline+=%3*  "switch to User3 highlight
set statusline+=\ %P\   "percentage thru file
set statusline+=%2*  "switch to User2 highlight
set statusline+=%=      "left/right separator
set statusline+=\ %F\   "full filename
set statusline+=%*   "switch back to statusline highlight


" Rename tabs to show tab number.
" (Based on http://stackoverflow.com/questions/5927952/whats-implementation-of-vims-default-tabline-function)
if exists("+showtabline")
    function! MyTabLine()
        let s = ''
        let wn = ''
        let t = tabpagenr()
        let i = 1
        while i <= tabpagenr('$')
            let buflist = tabpagebuflist(i)
            let winnr = tabpagewinnr(i)
            let s .= '%' . i . 'T'
            let s .= (i == t ? '%1*' : '%4*')
            let s .= ' '
            let wn = tabpagewinnr(i,'$')
            let s .= '%#TabNum#'
            let s .= i
            let s .= (i == t ? '%#TabLineSel#' : '%#TabLine#')
            let bufnr = buflist[winnr - 1]
            let file = bufname(bufnr)
            let buftype = getbufvar(bufnr, 'buftype')
            if buftype == 'nofile'
                if file =~ '\/.'
                    let file = substitute(file, '.*\/\ze.', '', '')
                endif
            else
                let file = fnamemodify(file, ':p:t')
            endif
            if file == ''
                let file = '[No Name]'
            endif
            let s .= ' ' . file . ' '
            let i = i + 1
        endwhile
        let s .= '%T%#TabLineFill#%='
        let s .= (tabpagenr('$') > 1 ? '%999XX' : 'X')
        return s
    endfunction
    set stal=2
    set tabline=%!MyTabLine()
    set showtabline=1
    highlight link TabNum Special
endif

" why ? for vsp
augroup CursorLineOnlyInActiveWindow
  autocmd!
  autocmd VimEnter,WinEnter,BufWinEnter * setlocal cursorline cursorcolumn
  autocmd WinLeave * setlocal nocursorline nocursorcolumn
augroup END
highlight cursorcolumn cterm=reverse ctermbg=NONE ctermfg=GREEN
highlight cursorline ctermbg=green ctermfg=black
highlight CursorLineNr ctermbg=green ctermfg=black

" Disable syntax highlighting to improve performance
syntax on

augroup variable
  autocmd!
  iabbrev <buffer><silent> time. <C-R>=strftime("%Y-%m-%d %H:%M:%S")<CR>
  iabbrev <buffer><silent> date. <C-R>=strftime("%Y-%m-%d")<CR>
  " day of week
  iabbrev dow. <C-R>=strftime("%A")<CR>
augroup END

augroup html_snippets
  autocmd!
  autocmd FileType html iabbrev html. <!DOCTYPE html><CR><html><CR><head><CR><meta charset="UTF-8"><CR><meta name="description" content=""><CR><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><CR><meta name="apple-mobile-web-app-capable" content="yes"><CR><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><CR><meta name="apple-touch-fullscreen" content="yes"><CR><meta name="format-detection" content="telephone=no, address=no"><CR><link rel="icon" href="../images/favicon-128.webp" /><CR><link rel="apple-touch-icon" href="../images/favicon-128.webp" /><CR><link rel="stylesheet" type="text/css" href="../stylesheets/common.css"><CR><title><C-R>=substitute(expand('%:t'), '\.html$', '', '')<CR></title><CR><style><CR></style><CR></head><CR><body><CR><div class="copy">Copyright &copy; <C-R>=strftime("%Y")<CR>-<script>document.write(new Date().getFullYear())</script> <a href="https://markbuild.com/" target="_blank">markbuild</a></div><CR></body><CR><script><CR></script><CR></html>
  autocmd FileType html iabbrev nofavicon. <link rel="icon" href="data:,">
  autocmd FileType html iabbrev noindex. <meta name="robots" content="noindex">
augroup END

:command Gpl !cd %:h;git pull

" Sync file to markbuild 
:command Mscp !~/Software/mscp %

" Uniq for vimword
:command Uniq %s/^\(.*\)\n\1$/\1/ 
command! Wd windo diffthis
command! Wo windo diffoff

" search current word
nnoremap ,n :let @/='\<<C-R>=expand("<cword>")<CR>\>'<CR>:set hlsearch<CR>

" open import
nnoremap ,O :execute "tabedit" expand("%:p:h") . "/" . expand("<cfile>:p")<CR>

nnoremap ,o :!open %<CR><CR>
" ,v use vscode open current file
nnoremap ,v :!code %<CR><CR>
" nnoremap ,v :!start ~/code.lnk <C-r>=expand('%:p')<CR><CR>

nnoremap ,u :!open <cfile><CR><CR>
nnoremap ,r :source ~/.vimrc<CR>
nnoremap ,b :cd %:h<CR>:let cmd=":r!git blame -L ".line('.').",".line('.')." -el %:t"<CR>:execute cmd<CR>
nnoremap ,l :cd %:h<CR>:let cmd=":r!git log -L ".line('.').",".line('.').":%:t"<CR>:execute cmd<CR>
" nnoremap ,p :set paste<CR>"+p:set nopaste<CR>
" :map ,y "+y

" disable c-w-w
nnoremap <C-W><C-W> <Nop>
nnoremap <C-h> <C-w><C-h>
nnoremap <C-l> <C-w><C-l>
nnoremap <C-z> <Nop> " stop C-z exit vim without save
